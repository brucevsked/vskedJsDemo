<!DOCTYPE HTML>
<html>
<head>
<!-- must set here! -->
<base href="">

<title>settimeout</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">


</head>

<body>
  <span id="_h1a">0</span>小时<span id="_m1a"></span>分<span id="_s1a"></span>秒
<script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.3.1.min.js" type="text/javascript"></script>
<script type="text/javascript">
$(function(){

	myTestA1.test1();

});

var myTestA1=new Object({
  endDateTime:'2018-11-27 21:37:40',
	test1:function(){
	  var endMap=myTestA1.getDateA1(myTestA1.endDateTime);
		var endHour=endMap.h;
		var endMin=endMap.m;
		var endSec=endMap.s;
		var curDate=new Date();
		var curHour=curDate.getHours();
		var curMin=curDate.getMinutes();
		var curSec=curDate.getSeconds();
		console.log(endMin+'|'+curMin+'|'+endSec+'|'+curSec);
		var subSec=endSec-curSec;
		if(subSec<0){
		  subSec=parseInt(endSec)+60-curSec;
		  endMin=endMin-1;
		}
		$('#_s1a').html(subSec);
		var subMin=endMin-curMin;
		if(subMin<0){
		  subMin=parseInt(endMin)+60-curMin;
		  endHour=endHour-1;
		}
		$('#_m1a').html(subMin);
		//console.log((subMin==0 && subSec==0)+'|'+subSec+'|'+subMin);
		if((subMin<=0 && subSec<=0) || subMin>9){
		  $('#_m1a').html('0');
		  $('#_s1a').html('0');
		  clearTimeout(window.runState);
		  console.log('clean over ---------');
		  return false;
		}
		
		window.runState=setTimeout(myTestA1.test1,500);
		
	},
	getDateA1:function(str){
	  var tmpAr1=str.split(' ');
	  var tmpAr2=tmpAr1[1].split(':');
		var h=tmpAr2[0];
		var m=tmpAr2[1];
		var s=tmpAr2[2];
		return {'h':h,'m':m,'s':s}
	}
});
</script>

</body>
</html>